{{
	def is_alpine319:
	    env.from | contains("alpine3.19")
-}}
FROM alpine:{{ env.alpineVer }} as curl-builder

RUN apk upgrade \
    && apk add alpine-sdk

{{ if is_alpine319 and env.version == "8.0" then ( -}}
COPY --from=openssl1-builder /home/abuild/packages/home/x86_64 /openssl1-packages
RUN apk add --allow-untrusted /openssl1-packages/*.apk
#RUN ln -s /usr/bin/openssl1.1 /usr/bin/openssl
{{ ) else "" end -}}

RUN set -eux; \
    adduser -D -S -G abuild abuild

RUN addgroup abuild abuild \
    && mkdir -p /var/cache/distfiles \
    && chgrp abuild /var/cache/distfiles \
    && chmod a+w /var/cache/distfiles

WORKDIR /home/abuild
USER abuild

RUN abuild-keygen -an

COPY CURL_APKBUILD /home/abuild/APKBUILD

RUN abuild checksum \
    && abuild -r

